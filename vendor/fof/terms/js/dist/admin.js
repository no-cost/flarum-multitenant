(()=>{var t={912:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,r="millisecond",n="second",o="minute",i="hour",a="day",s="week",l="month",c="quarter",u="year",d="date",f="Invalid Date",m=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,p=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,h={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},g=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},v={s:g,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),o=r%60;return(e<=0?"+":"-")+g(n,2,"0")+":"+g(o,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),o=e.clone().add(n,l),i=r-o<0,a=e.clone().add(n+(i?-1:1),l);return+(-(n+(r-o)/(i?o-a:a-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:l,y:u,w:s,d:a,D:d,h:i,m:o,s:n,ms:r,Q:c}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},y="en",b={};b[y]=h;var w="$isDayjsObject",E=function(t){return t instanceof $||!(!t||!t[w])},T=function t(e,r,n){var o;if(!e)return y;if("string"==typeof e){var i=e.toLowerCase();b[i]&&(o=i),r&&(b[i]=r,o=i);var a=e.split("-");if(!o&&a.length>1)return t(a[0])}else{var s=e.name;b[s]=e,o=s}return!n&&o&&(y=o),o||!n&&y},x=function(t,e){if(E(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new $(r)},M=v;M.l=T,M.i=E,M.w=function(t,e){return x(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var $=function(){function h(t){this.$L=T(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var g=h.prototype;return g.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(M.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(m);if(n){var o=n[2]-1||0,i=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)):new Date(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,i)}}return new Date(e)}(t),this.init()},g.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},g.$utils=function(){return M},g.isValid=function(){return!(this.$d.toString()===f)},g.isSame=function(t,e){var r=x(t);return this.startOf(e)<=r&&r<=this.endOf(e)},g.isAfter=function(t,e){return x(t)<this.startOf(e)},g.isBefore=function(t,e){return this.endOf(e)<x(t)},g.$g=function(t,e,r){return M.u(t)?this[e]:this.set(r,t)},g.unix=function(){return Math.floor(this.valueOf()/1e3)},g.valueOf=function(){return this.$d.getTime()},g.startOf=function(t,e){var r=this,c=!!M.u(e)||e,f=M.p(t),m=function(t,e){var n=M.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return c?n:n.endOf(a)},p=function(t,e){return M.w(r.toDate()[t].apply(r.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},h=this.$W,g=this.$M,v=this.$D,y="set"+(this.$u?"UTC":"");switch(f){case u:return c?m(1,0):m(31,11);case l:return c?m(1,g):m(0,g+1);case s:var b=this.$locale().weekStart||0,w=(h<b?h+7:h)-b;return m(c?v-w:v+(6-w),g);case a:case d:return p(y+"Hours",0);case i:return p(y+"Minutes",1);case o:return p(y+"Seconds",2);case n:return p(y+"Milliseconds",3);default:return this.clone()}},g.endOf=function(t){return this.startOf(t,!1)},g.$set=function(t,e){var s,c=M.p(t),f="set"+(this.$u?"UTC":""),m=(s={},s[a]=f+"Date",s[d]=f+"Date",s[l]=f+"Month",s[u]=f+"FullYear",s[i]=f+"Hours",s[o]=f+"Minutes",s[n]=f+"Seconds",s[r]=f+"Milliseconds",s)[c],p=c===a?this.$D+(e-this.$W):e;if(c===l||c===u){var h=this.clone().set(d,1);h.$d[m](p),h.init(),this.$d=h.set(d,Math.min(this.$D,h.daysInMonth())).$d}else m&&this.$d[m](p);return this.init(),this},g.set=function(t,e){return this.clone().$set(t,e)},g.get=function(t){return this[M.p(t)]()},g.add=function(r,c){var d,f=this;r=Number(r);var m=M.p(c),p=function(t){var e=x(f);return M.w(e.date(e.date()+Math.round(t*r)),f)};if(m===l)return this.set(l,this.$M+r);if(m===u)return this.set(u,this.$y+r);if(m===a)return p(1);if(m===s)return p(7);var h=(d={},d[o]=t,d[i]=e,d[n]=1e3,d)[m]||1,g=this.$d.getTime()+r*h;return M.w(g,this)},g.subtract=function(t,e){return this.add(-1*t,e)},g.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||f;var n=t||"YYYY-MM-DDTHH:mm:ssZ",o=M.z(this),i=this.$H,a=this.$m,s=this.$M,l=r.weekdays,c=r.months,u=r.meridiem,d=function(t,r,o,i){return t&&(t[r]||t(e,n))||o[r].slice(0,i)},m=function(t){return M.s(i%12||12,t,"0")},h=u||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(p,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return M.s(e.$y,4,"0");case"M":return s+1;case"MM":return M.s(s+1,2,"0");case"MMM":return d(r.monthsShort,s,c,3);case"MMMM":return d(c,s);case"D":return e.$D;case"DD":return M.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return d(r.weekdaysMin,e.$W,l,2);case"ddd":return d(r.weekdaysShort,e.$W,l,3);case"dddd":return l[e.$W];case"H":return String(i);case"HH":return M.s(i,2,"0");case"h":return m(1);case"hh":return m(2);case"a":return h(i,a,!0);case"A":return h(i,a,!1);case"m":return String(a);case"mm":return M.s(a,2,"0");case"s":return String(e.$s);case"ss":return M.s(e.$s,2,"0");case"SSS":return M.s(e.$ms,3,"0");case"Z":return o}return null}(t)||o.replace(":","")}))},g.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},g.diff=function(r,d,f){var m,p=this,h=M.p(d),g=x(r),v=(g.utcOffset()-this.utcOffset())*t,y=this-g,b=function(){return M.m(p,g)};switch(h){case u:m=b()/12;break;case l:m=b();break;case c:m=b()/3;break;case s:m=(y-v)/6048e5;break;case a:m=(y-v)/864e5;break;case i:m=y/e;break;case o:m=y/t;break;case n:m=y/1e3;break;default:m=y}return f?m:M.a(m)},g.daysInMonth=function(){return this.endOf(l).$D},g.$locale=function(){return b[this.$L]},g.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=T(t,e,!0);return n&&(r.$L=n),r},g.clone=function(){return M.w(this.$d,this)},g.toDate=function(){return new Date(this.valueOf())},g.toJSON=function(){return this.isValid()?this.toISOString():null},g.toISOString=function(){return this.$d.toISOString()},g.toString=function(){return this.$d.toUTCString()},h}(),_=$.prototype;return x.prototype=_,[["$ms",r],["$s",n],["$m",o],["$H",i],["$W",a],["$M",l],["$y",u],["$D",d]].forEach((function(t){_[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),x.extend=function(t,e){return t.$i||(t(e,$,x),t.$i=!0),x},x.locale=T,x.isDayjs=E,x.unix=function(t){return x(1e3*t)},x.en=b[y],x.Ls=b,x.p={},x}()}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{components:()=>Mt,extend:()=>Tt,helpers:()=>_t,models:()=>$t});const t=flarum.core.compat["admin/app"];var e=r.n(t);function o(t,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},o(t,e)}function i(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)}const a=flarum.core.compat["admin/components/ExtensionPage"];var s=r.n(a);const l=flarum.core.compat["common/components/Switch"];var c=r.n(l);function u(t,e,r){if(void 0===r)return t&&t.h5s&&t.h5s.data&&t.h5s.data[e];t.h5s=t.h5s||{},t.h5s.data=t.h5s.data||{},t.h5s.data[e]=r}var d=function(t,e){if(!(t instanceof NodeList||t instanceof HTMLCollection||t instanceof Array))throw new Error("You must provide a nodeList/HTMLCollection/Array of elements to be filtered.");return"string"!=typeof e?Array.from(t):Array.from(t).filter((function(t){return 1===t.nodeType&&t.matches(e)}))},f=new Map,p=function(){function t(){this._config=new Map,this._placeholder=void 0,this._data=new Map}return Object.defineProperty(t.prototype,"config",{get:function(){var t={};return this._config.forEach((function(e,r){t[r]=e})),t},set:function(t){if("object"!=typeof t)throw new Error("You must provide a valid configuration object to the config setter.");var e=Object.assign({},t);this._config=new Map(Object.entries(e))},enumerable:!1,configurable:!0}),t.prototype.setConfig=function(t,e){if(!this._config.has(t))throw new Error("Trying to set invalid configuration item: "+t);this._config.set(t,e)},t.prototype.getConfig=function(t){if(!this._config.has(t))throw new Error("Invalid configuration item requested: "+t);return this._config.get(t)},Object.defineProperty(t.prototype,"placeholder",{get:function(){return this._placeholder},set:function(t){if(!(t instanceof HTMLElement)&&null!==t)throw new Error("A placeholder must be an html element or null.");this._placeholder=t},enumerable:!1,configurable:!0}),t.prototype.setData=function(t,e){if("string"!=typeof t)throw new Error("The key must be a string.");this._data.set(t,e)},t.prototype.getData=function(t){if("string"!=typeof t)throw new Error("The key must be a string.");return this._data.get(t)},t.prototype.deleteData=function(t){if("string"!=typeof t)throw new Error("The key must be a string.");return this._data.delete(t)},t}(),h=function(t){if(!(t instanceof HTMLElement))throw new Error("Please provide a sortable to the store function.");return f.has(t)||f.set(t,new p),f.get(t)};function g(t,e,r){if(t instanceof Array)for(var n=0;n<t.length;++n)g(t[n],e,r);else t.addEventListener(e,r),h(t).setData("event"+e,r)}function v(t,e){if(t instanceof Array)for(var r=0;r<t.length;++r)v(t[r],e);else t.removeEventListener(e,h(t).getData("event"+e)),h(t).deleteData("event"+e)}function y(t,e,r){if(t instanceof Array)for(var n=0;n<t.length;++n)y(t[n],e,r);else t.setAttribute(e,r)}function b(t,e){if(t instanceof Array)for(var r=0;r<t.length;++r)b(t[r],e);else t.removeAttribute(e)}var w,E,T,x,M,$,_,D,S,C=function(t){if(!t.parentElement||0===t.getClientRects().length)throw new Error("target element must be part of the dom");var e=t.getClientRects()[0];return{left:e.left+window.pageXOffset,right:e.right+window.pageXOffset,top:e.top+window.pageYOffset,bottom:e.bottom+window.pageYOffset}},N=function(t,e){if(!(t instanceof HTMLElement&&(e instanceof NodeList||e instanceof HTMLCollection||e instanceof Array)))throw new Error("You must provide an element and a list of elements.");return Array.from(e).indexOf(t)},F=function(t){if(!(t instanceof HTMLElement))throw new Error("Element is not a node element.");return null!==t.parentNode},A=function(t,e,r){if(!(t instanceof HTMLElement&&t.parentElement instanceof HTMLElement))throw new Error("target and element must be a node");t.parentElement.insertBefore(e,"before"===r?t:t.nextElementSibling)},L=function(t,e){return A(t,e,"after")},O=function(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");var e=window.getComputedStyle(t);return"border-box"===e.getPropertyValue("box-sizing")?parseInt(e.getPropertyValue("height"),10):["height","padding-top","padding-bottom"].map((function(t){var r=parseInt(e.getPropertyValue(t),10);return isNaN(r)?0:r})).reduce((function(t,e){return t+e}))},P=function(t){if(!(t instanceof HTMLElement))throw new Error("You must provide a valid dom element");var e=window.getComputedStyle(t);return["width","padding-left","padding-right"].map((function(t){var r=parseInt(e.getPropertyValue(t),10);return isNaN(r)?0:r})).reduce((function(t,e){return t+e}))},H=function(t,e){if(!(t instanceof Array))throw new Error("You must provide a Array of HTMLElements to be filtered.");return"string"!=typeof e?t:t.filter((function(t){return t.querySelector(e)instanceof HTMLElement||t.shadowRoot&&t.shadowRoot.querySelector(e)instanceof HTMLElement})).map((function(t){return t.querySelector(e)||t.shadowRoot&&t.shadowRoot.querySelector(e)}))},I=function(t){return t.composedPath&&t.composedPath()[0]||t.target},Y=function(t,e,r){return{element:t,posX:r.pageX-e.left,posY:r.pageY-e.top}},k=function(t,e){if(!0===t.isSortable){var r=h(t).getConfig("acceptFrom");if(null!==r&&!1!==r&&"string"!=typeof r)throw new Error('HTML5Sortable: Wrong argument, "acceptFrom" must be "null", "false", or a valid selector string.');if(null!==r)return!1!==r&&r.split(",").filter((function(t){return t.length>0&&e.matches(t)})).length>0;if(t===e)return!0;if(void 0!==h(t).getConfig("connectWith")&&null!==h(t).getConfig("connectWith"))return h(t).getConfig("connectWith")===h(e).getConfig("connectWith")}return!1},j={items:null,connectWith:null,disableIEFix:null,acceptFrom:null,copy:!1,placeholder:null,placeholderClass:"sortable-placeholder",draggingClass:"sortable-dragging",hoverClass:!1,dropTargetContainerClass:!1,debounce:0,throttleTime:100,maxItems:0,itemSerializer:void 0,containerSerializer:void 0,customDragImage:null,orientation:"vertical"},B=function(t){v(t,"dragstart"),v(t,"dragend"),v(t,"dragover"),v(t,"dragenter"),v(t,"drop"),v(t,"mouseenter"),v(t,"mouseleave")},W=function(t,e){t&&v(t,"dragleave"),e&&e!==t&&v(e,"dragleave")},z=function(t){var e;(e=t).h5s&&delete e.h5s.data,b(t,"aria-dropeffect")},q=function(t){b(t,"aria-grabbed"),b(t,"aria-copied"),b(t,"draggable"),b(t,"role")};function U(t,e){if(e.composedPath)return e.composedPath().find((function(t){return t.isSortable}));for(;!0!==t.isSortable;)t=t.parentElement;return t}function R(t,e){var r=u(t,"opts"),n=d(t.children,r.items).filter((function(t){return t.contains(e)||t.shadowRoot&&t.shadowRoot.contains(e)}));return n.length>0?n[0]:e}var X=function(t){var e=u(t,"opts"),r=d(t.children,e.items),n=H(r,e.handle);y(t,"aria-dropeffect","move"),u(t,"_disabled","false"),y(n,"draggable","true"),!1===e.disableIEFix&&"function"==typeof(document||window.document).createElement("span").dragDrop&&g(n,"mousedown",(function(){if(-1!==r.indexOf(this))this.dragDrop();else{for(var t=this.parentElement;-1===r.indexOf(t);)t=t.parentElement;t.dragDrop()}}))};function V(t,e){var r=String(e);return e=e||{},"string"==typeof t&&(t=document.querySelectorAll(t)),t instanceof HTMLElement&&(t=[t]),t=Array.prototype.slice.call(t),/serialize/.test(r)?t.map((function(t){var e=u(t,"opts");return function(t,e,r){if(void 0===e&&(e=function(t,e){return t}),void 0===r&&(r=function(t){return t}),!(t instanceof HTMLElement)||1==!t.isSortable)throw new Error("You need to provide a sortableContainer to be serialized.");if("function"!=typeof e||"function"!=typeof r)throw new Error("You need to provide a valid serializer for items and the container.");var n=u(t,"opts").items,o=d(t.children,n),i=o.map((function(e){return{parent:t,node:e,html:e.outerHTML,index:N(e,o)}}));return{container:r({node:t,itemCount:i.length}),items:i.map((function(r){return e(r,t)}))}}(t,e.itemSerializer,e.containerSerializer)})):(t.forEach((function(t){if(/enable|disable|destroy/.test(r))return V[r](t);["connectWith","disableIEFix"].forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)&&null!==e[t]&&console.warn('HTML5Sortable: You are using the deprecated configuration "'+t+'". This will be removed in an upcoming version, make sure to migrate to the new options when updating.')})),e=Object.assign({},j,h(t).config,e),h(t).config=e,u(t,"opts",e),t.isSortable=!0,function(t){var e=u(t,"opts"),r=d(t.children,e.items),n=H(r,e.handle);u(t,"_disabled","false"),B(r),W(x,D),v(n,"mousedown"),v(t,"dragover"),v(t,"dragenter"),v(t,"drop")}(t);var n,o=d(t.children,e.items);if(null!==e.placeholder&&void 0!==e.placeholder){var i=document.createElement(t.tagName);e.placeholder instanceof HTMLElement?i.appendChild(e.placeholder):i.innerHTML=e.placeholder,n=i.children[0]}h(t).placeholder=function(t,e,r){var n;if(void 0===r&&(r="sortable-placeholder"),!(t instanceof HTMLElement))throw new Error("You must provide a valid element as a sortable.");if(!(e instanceof HTMLElement)&&void 0!==e)throw new Error("You must provide a valid element as a placeholder or set ot to undefined.");return void 0===e&&(["UL","OL"].includes(t.tagName)?e=document.createElement("li"):["TABLE","TBODY"].includes(t.tagName)?(e=document.createElement("tr")).innerHTML='<td colspan="100"></td>':e=document.createElement("div")),"string"==typeof r&&(n=e.classList).add.apply(n,r.split(" ")),e}(t,n,e.placeholderClass),u(t,"items",e.items),e.acceptFrom?u(t,"acceptFrom",e.acceptFrom):e.connectWith&&u(t,"connectWith",e.connectWith),X(t),y(o,"role","option"),y(o,"aria-grabbed","false"),function(t,e){if("string"==typeof h(t).getConfig("hoverClass")){var r=h(t).getConfig("hoverClass").split(" ");!0===e?(g(t,"mousemove",function(t,e){var r=this;if(void 0===e&&(e=250),"number"!=typeof e)throw new Error("You must provide a number as the second argument for throttle.");var n=null;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var a=Date.now();(null===n||a-n>=e)&&(n=a,t.apply(r,o))}}((function(e){0===e.buttons&&d(t.children,h(t).getConfig("items")).forEach((function(t){var n,o;t!==e.target?(n=t.classList).remove.apply(n,r):(o=t.classList).add.apply(o,r)}))}),h(t).getConfig("throttleTime"))),g(t,"mouseleave",(function(){d(t.children,h(t).getConfig("items")).forEach((function(t){var e;(e=t.classList).remove.apply(e,r)}))}))):(v(t,"mousemove"),v(t,"mouseleave"))}}(t,!0),g(t,"dragstart",(function(t){var r=I(t);if(!0!==r.isSortable&&(t.stopImmediatePropagation(),(!e.handle||r.matches(e.handle))&&"false"!==r.getAttribute("draggable"))){var n=U(r,t),o=R(n,r);_=d(n.children,e.items),M=_.indexOf(o),$=N(o,n.children),x=n,function(t,e,r){if(!(t instanceof Event))throw new Error("setDragImage requires a DragEvent as the first argument.");if(!(e instanceof HTMLElement))throw new Error("setDragImage requires the dragged element as the second argument.");if(r||(r=Y),t.dataTransfer&&t.dataTransfer.setDragImage){var n=r(e,C(e),t);if(!(n.element instanceof HTMLElement)||"number"!=typeof n.posX||"number"!=typeof n.posY)throw new Error("The customDragImage function you provided must return and object with the properties element[string], posX[integer], posY[integer].");t.dataTransfer.effectAllowed="copyMove",t.dataTransfer.setData("text/plain",I(t).id),t.dataTransfer.setDragImage(n.element,n.posX,n.posY)}}(t,o,e.customDragImage),E=O(o),T=P(o),o.classList.add(e.draggingClass),w=function(t,e){var r=t;return!0===h(e).getConfig("copy")&&(y(r=t.cloneNode(!0),"aria-copied","true"),t.parentElement.appendChild(r),r.style.display="none",r.oldDisplay=t.style.display),r}(o,n),y(w,"aria-grabbed","true"),n.dispatchEvent(new CustomEvent("sortstart",{detail:{origin:{elementIndex:$,index:M,container:x},item:w,originalTarget:r}}))}})),g(t,"dragenter",(function(r){var n=I(r),o=U(n,r);o&&o!==D&&(S=d(o.children,u(o,"items")).filter((function(e){return e!==h(t).placeholder})),e.dropTargetContainerClass&&o.classList.add(e.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortenter",{detail:{origin:{elementIndex:$,index:M,container:x},destination:{container:o,itemsBeforeUpdate:S},item:w,originalTarget:n}})),g(o,"dragleave",(function(t){var r=t.relatedTarget||t.fromElement;t.currentTarget.contains(r)||(e.dropTargetContainerClass&&o.classList.remove(e.dropTargetContainerClass),o.dispatchEvent(new CustomEvent("sortleave",{detail:{origin:{elementIndex:$,index:M,container:o},item:w,originalTarget:n}})))}))),D=o})),g(t,"dragend",(function(r){if(w){w.classList.remove(e.draggingClass),y(w,"aria-grabbed","false"),"true"===w.getAttribute("aria-copied")&&"true"!==u(w,"dropped")&&w.remove(),w.style.display=w.oldDisplay,delete w.oldDisplay;var n=Array.from(f.values()).map((function(t){return t.placeholder})).filter((function(t){return t instanceof HTMLElement})).filter(F)[0];n&&n.remove(),t.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:$,index:M,container:x},item:w}})),D=null,w=null,E=null,T=null}})),g(t,"drop",(function(r){if(k(t,w.parentElement)){r.preventDefault(),r.stopPropagation(),u(w,"dropped","true");var n=Array.from(f.values()).map((function(t){return t.placeholder})).filter((function(t){return t instanceof HTMLElement})).filter(F)[0];L(n,w),n.remove(),t.dispatchEvent(new CustomEvent("sortstop",{detail:{origin:{elementIndex:$,index:M,container:x},item:w}}));var o=h(t).placeholder,i=d(x.children,e.items).filter((function(t){return t!==o})),a=!0===this.isSortable?this:this.parentElement,s=d(a.children,u(a,"items")).filter((function(t){return t!==o})),l=N(w,Array.from(w.parentElement.children).filter((function(t){return t!==o}))),c=N(w,s);e.dropTargetContainerClass&&a.classList.remove(e.dropTargetContainerClass),$===l&&x===a||t.dispatchEvent(new CustomEvent("sortupdate",{detail:{origin:{elementIndex:$,index:M,container:x,itemsBeforeUpdate:_,items:i},destination:{index:c,elementIndex:l,container:a,itemsBeforeUpdate:S,items:s},item:w}}))}}));var a,s,l,c=(a=function(t,r,n,o){if(w)if(e.forcePlaceholderSize&&(h(t).placeholder.style.height=E+"px",h(t).placeholder.style.width=T+"px"),Array.from(t.children).indexOf(r)>-1){var i=O(r),a=P(r),s=N(h(t).placeholder,r.parentElement.children),l=N(r,r.parentElement.children);if(i>E||a>T){var c=i-E,u=a-T,m=C(r).top,p=C(r).left;if(s<l&&("vertical"===e.orientation&&o<m||"horizontal"===e.orientation&&n<p))return;if(s>l&&("vertical"===e.orientation&&o>m+i-c||"horizontal"===e.orientation&&n>p+a-u))return}void 0===w.oldDisplay&&(w.oldDisplay=w.style.display),"none"!==w.style.display&&(w.style.display="none");var g=!1;try{var v=C(r).top+r.offsetHeight/2,y=C(r).left+r.offsetWidth/2;g="vertical"===e.orientation&&o>=v||"horizontal"===e.orientation&&n>=y}catch(t){g=s<l}g?L(r,h(t).placeholder):function(t,e){A(t,e,"before")}(r,h(t).placeholder),Array.from(f.values()).filter((function(t){return void 0!==t.placeholder})).forEach((function(e){e.placeholder!==h(t).placeholder&&e.placeholder.remove()}))}else{var b=Array.from(f.values()).filter((function(t){return void 0!==t.placeholder})).map((function(t){return t.placeholder}));-1!==b.indexOf(r)||t!==r||d(r.children,e.items).length||(b.forEach((function(t){return t.remove()})),r.appendChild(h(t).placeholder))}},void 0===(s=e.debounce)&&(s=0),function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];clearTimeout(l),l=setTimeout((function(){a.apply(void 0,t)}),s)}),m=function(t){var e=t.target,r=!0===e.isSortable?e:U(e,t);if(e=R(r,e),w&&k(r,w.parentElement)&&"true"!==u(r,"_disabled")){var n=u(r,"opts");parseInt(n.maxItems)&&d(r.children,u(r,"items")).length>=parseInt(n.maxItems)&&w.parentElement!==r||(t.preventDefault(),t.stopPropagation(),t.dataTransfer.dropEffect=!0===h(r).getConfig("copy")?"copy":"move",c(r,e,t.pageX,t.pageY))}};g(o.concat(t),"dragover",m),g(o.concat(t),"dragenter",m)})),t)}V.destroy=function(t){!function(t){var e=u(t,"opts")||{},r=d(t.children,e.items),n=H(r,e.handle);v(t,"dragover"),v(t,"dragenter"),v(t,"dragstart"),v(t,"dragend"),v(t,"drop"),z(t),v(n,"mousedown"),B(r),q(r),W(x,D),t.isSortable=!1}(t)},V.enable=function(t){X(t)},V.disable=function(t){!function(t){var e=u(t,"opts"),r=d(t.children,e.items),n=H(r,e.handle);y(t,"aria-dropeffect","none"),u(t,"_disabled","true"),y(n,"draggable","false"),v(n,"mousedown")}(t)},V.__testing={_data:u,_removeItemEvents:B,_removeItemData:q,_removeSortableData:z,_removeContainerEvents:W};const G=V,J=flarum.core.compat["common/Component"];var Z=r.n(J);const Q=flarum.core.compat["common/helpers/icon"];var K=r.n(Q);const tt=flarum.core.compat["common/utils/extractText"];var et=r.n(tt);const rt=flarum.core.compat["common/utils/ItemList"];var nt=r.n(rt);const ot=flarum.core.compat["common/components/Button"];var it=r.n(ot),at=r(912),st=r.n(at),lt=function(t){function r(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).policy=void 0,e.dirty=!1,e.processing=!1,e.toggleFields=!1,e}i(r,t);var n=r.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.policy=e.attrs.policy,null===this.policy&&this.initNewField()},n.initNewField=function(){this.policy=e().store.createRecord("fof-terms-policies",{attributes:{name:"",url:"",update_message:"",terms_updated_at:"",optional:!1,additional_info:{}}})},n.boxTitle=function(){return this.policy.exists?this.policy.name():e().translator.trans("fof-terms.admin.buttons.new-policy")},n.view=function(){var t=this;return m("div",{className:"FoF-Terms-Policiy-Box"},this.policy.exists&&m("span",{className:"fas fa-arrows-alt FoF-Terms-Policiy-Box--handle js-policy-handle"}),m("div",{className:"Button Button--block FoF-Terms-Policiy-Header",onclick:function(){t.toggleFields=!t.toggleFields}},m("div",{className:"FoF-Terms-Policiy-Header-Title"},this.boxTitle()),m("div",null,this.policy.exists&&[e().translator.trans("fof-terms.admin.buttons.edit-policy")," "],K()(this.toggleFields?"fas fa-chevron-up":"fas fa-chevron-down"))),this.toggleFields&&this.viewFields())},n.viewFields=function(){var t=this;return m("form",{className:"FoF-Terms-Policiy-Body",onsubmit:this.savePolicy.bind(this)},this.fields().toArray(),m("div",{className:"ButtonGroup"},m(it(),{type:"submit",className:"Button Button--primary",loading:this.processing,disabled:!this.readyToSave()},e().translator.trans("fof-terms.admin.buttons."+(this.policy.exists?"save":"add")+"-policy")),this.policy.exists&&m(it(),{type:"submit",className:"Button Button--danger",loading:this.processing,onclick:function(e){return t.deletePolicy(e)}},e().translator.trans("fof-terms.admin.buttons.delete-policy"))))},n.fields=function(){var t=this,r=new(nt());return r.add("name",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-terms.admin.policies.name")),m("input",{className:"FormControl",type:"text",value:this.policy.name(),oninput:function(e){t.updateAttribute("name",e.target.value)}}),m("div",{className:"helpText"},e().translator.trans("fof-terms.admin.policies.name-help"))),100),r.add("url",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-terms.admin.policies.url")),m("input",{className:"FormControl",type:"url",value:this.policy.url(),oninput:function(e){t.updateAttribute("url",e.target.value)}}),m("div",{className:"helpText"},e().translator.trans("fof-terms.admin.policies.url-help"))),95),r.add("update-message",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-terms.admin.policies.update-message")),m("textarea",{className:"FormControl",value:this.policy.update_message(),oninput:function(e){t.updateAttribute("update_message",e.target.value)}}),m("div",{className:"helpText"},e().translator.trans("fof-terms.admin.policies.update-message-help"))),90),r.add("terms-updated-at",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-terms.admin.policies.terms-updated-at")),m("div",{className:"FoF-Terms-Input-Group"},m("input",{className:"FormControl",type:"text",value:this.policy.terms_updated_at(),oninput:function(e){t.updateAttribute("terms_updated_at",e.target.value)},placeholder:e().translator.trans("fof-terms.admin.policies.terms-updated-at-placeholder")}),m(it(),{className:"Button Button--primary",onclick:function(){t.updateAttribute("terms_updated_at",st()().millisecond(0).toISOString())}},e().translator.trans("fof-terms.admin.buttons.set-to-now"))),m("div",{className:"helpText"},e().translator.trans("fof-terms.admin.policies.terms-updated-at-help"))),85),r.add("optional",m("div",{className:"Form-group"},m("div",{className:"fof-terms-optional-checkbox"},m("label",{className:"Form-group>label"},e().translator.trans("fof-terms.admin.policies.optional")),m(c(),{className:"fof-terms-Switch-off",state:this.policy.optional(),onchange:function(){t.updateAttribute("optional",!t.policy.optional())}})),m("div",{className:"helpText"},e().translator.trans("fof-terms.admin.policies.optional-help"))),83),this.policy.exists&&r.add("export-url",m("div",{className:"Form-group"},m("label",null,e().translator.trans("fof-terms.admin.policies.export-url")),m("div",{className:"ButtonGroup"},["json","csv"].map((function(r){return m("a",{className:"Button FoF-Terms-Export-Button",href:e().forum.attribute("apiUrl")+"/fof/terms/policies/"+t.policy.id()+"/export."+r,target:"_blank"},r.toUpperCase())}))),m("div",{className:"helpText"},e().translator.trans("fof-terms.admin.policies.export-url-help",{a:m("a",{href:"https://github.com/FriendsOfFlarum/terms/wiki/Export-url",target:"_blank"})}))),80),r},n.updateAttribute=function(t,e){var r;this.policy.pushAttributes(((r={})[t]=e,r)),this.dirty=!0},n.readyToSave=function(){return this.dirty},n.savePolicy=function(t){var e=this;t.preventDefault(),this.processing=!0;var r=!this.policy.exists;this.policy.save(this.policy.data.attributes||{}).then((function(){r&&(e.initNewField(),e.toggleFields=!1),e.processing=!1,e.dirty=!1,m.redraw()})).catch((function(t){throw e.processing=!1,t}))},n.deletePolicy=function(t){var r=this;t.preventDefault(),confirm(et()(e().translator.trans("fof-terms.admin.messages.delete-policy-confirmation",{name:this.policy.name()})))&&(this.processing=!0,this.policy.delete().then((function(){r.processing=!1,m.redraw()})).catch((function(t){throw r.processing=!1,t})))},r}(Z());function ct(t,e){return void 0===e&&(e="sort"),t.sort((function(t,r){return("function"==typeof t[e]?t[e]():t[e])-("function"==typeof r[e]?r[e]():r[e])}))}var ut=function(t){function r(){return t.apply(this,arguments)||this}i(r,t);var n=r.prototype;return n.oninit=function(r){t.prototype.oninit.call(this,r),e().request({method:"GET",url:e().forum.attribute("apiUrl")+"/fof/terms/policies"}).then((function(t){e().store.pushPayload(t),m.redraw()}))},n.oncreate=function(e){t.prototype.oncreate.call(this,e),this.initsortable(e)},n.onupdate=function(e){t.prototype.onupdate.call(this,e),this.initsortable(e)},n.initsortable=function(t){var e=this,r=t.dom.querySelector(".js-policies-container");r&&G(r,{handle:".js-policy-handle"})[0].addEventListener("sortupdate",(function(){var r=Array.from(t.dom.querySelectorAll(".js-policy-data")).map((function(t){return t.dataset.id}));e.updateSort(r)}))},n.view=function(){var t=ct(e().store.all("fof-terms-policies")).map((function(t){return m("div",{className:"js-policy-data",key:t.id(),"data-id":t.id()},m(lt,{policy:t}))}));return m("div",null,m("h2",null,e().translator.trans("fof-terms.admin.titles.policies")),m("div",{className:"FoF-Terms-Policies-Container"},m("div",{className:"js-policies-container"},t),m(lt,{policy:null})))},n.updateSort=function(t){e().request({method:"POST",url:e().forum.attribute("apiUrl")+"/fof/terms/policies/order",body:{sort:t}}).then((function(t){e().store.pushPayload(t),m.redraw()}))},r}(Z()),dt="fof-terms.",ft="fof-terms.admin.settings.",mt=function(t){function r(){return t.apply(this,arguments)||this}return i(r,t),r.prototype.content=function(t){return m("div",{className:"ExtensionPage-settings"},m("div",{className:"container"},m("div",{className:"Form-group"},m("label",null,e().translator.trans(ft+"field.signup-legal-text")),m("textarea",{className:"FormControl",bidi:this.setting(dt+"signup-legal-text")})),m("div",{className:"Form-group"},m("label",null,m(c(),{state:this.setting(dt+"hide-updated-at")()>0,onchange:this.setting(dt+"hide-updated-at")},e().translator.trans(ft+"field.hide-updated-at")))),m("div",{className:"Form-group"},m("label",null,e().translator.trans(ft+"field.date-format")),m("input",{type:"text",className:"FormControl",bidi:this.setting(dt+"date-format"),placeholder:"YYYY-MM-DD"}),m("div",{className:"helpText"},e().translator.trans(ft+"field.date-format-help",{a:m("a",{href:"https://day.js.org/docs/en/display/format",target:"_blank"})}))),this.submitButton(),m(ut,null)))},r}(s());const pt=flarum.core.compat["common/extenders"];var ht=r.n(pt);const gt=flarum.core.compat["common/Model"];var vt=r.n(gt);const yt=flarum.core.compat["common/utils/computed"];var bt=r.n(yt),wt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).sort=vt().attribute("sort"),e.name=vt().attribute("name"),e.url=vt().attribute("url"),e.update_message=vt().attribute("update_message"),e.terms_updated_at=vt().attribute("terms_updated_at"),e.optional=vt().attribute("optional"),e.additional_info=vt().attribute("additional_info"),e.form_key=bt()("id",(function(t){return"fof_terms_policy_"+t})),e}return i(e,t),e.prototype.apiEndpoint=function(){return"/fof/terms/policies"+(this.exists?"/"+this.id():"")},e}(vt());const Et=[(new(ht().Store)).add("fof-terms-policies",wt)],Tt=[].concat(Et);var xt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).keyattr=void 0,e.policy=void 0,e.setDirty=void 0,e}i(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.keyattr=e.attrs.keyattr,this.policy=e.attrs.policy,this.setDirty=e.attrs.setDirty,this.updateAttribute=this.updateAttribute.bind(this)},r.view=function(t){var e=t.children;return t.children&&Array.isArray(t.children)&&"function"==typeof t.children[0]&&(e=t.children[0]({keyattr:this.keyattr,policy:this.policy,updateAttribute:this.updateAttribute})),m("div",{className:"Form-group"},e)},r.updateAttribute=function(t){var e=this.policy.additional_info();e[this.keyattr]=t,this.policy.pushAttributes({additional_info:e}),this.setDirty()},e}(Z()),Mt={PolicyEdit:lt,PolicyList:ut,TermsSettingsPage:mt,ExtensionData:xt},$t={Policy:wt},_t={sortByAttribute:ct};e().initializers.add("fof-terms",(function(){e().extensionData.for("fof-terms").registerPermission({icon:"fas fa-paperclip",label:e().translator.trans("fof-terms.admin.permissions.see-user-policies-state"),permission:"fof-terms.see-user-policies-state"},"moderate").registerPermission({icon:"fas fa-paperclip",label:e().translator.trans("fof-terms.admin.permissions.postpone-policies-accept"),permission:"fof-terms.postpone-policies-accept"},"moderate").registerPermission({icon:"fas fa-paperclip",label:e().translator.trans("fof-terms.admin.permissions.export-policies"),permission:"fof-terms.export-policies"},"moderate").registerPage(mt)}))})(),module.exports=n})();
//# sourceMappingURL=admin.js.map