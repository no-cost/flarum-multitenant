/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={912:function(t){t.exports=function(){"use strict";var t=6e4,e=36e5,r="millisecond",n="second",o="minute",a="hour",i="day",s="week",c="month",u="quarter",l="year",f="date",m="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,d=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,h={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],r=t%100;return"["+t+(e[(r-20)%10]||e[r]||e[0])+"]"}},v=function(t,e,r){var n=String(t);return!n||n.length>=e?t:""+Array(e+1-n.length).join(r)+t},y={s:v,z:function(t){var e=-t.utcOffset(),r=Math.abs(e),n=Math.floor(r/60),o=r%60;return(e<=0?"+":"-")+v(n,2,"0")+":"+v(o,2,"0")},m:function t(e,r){if(e.date()<r.date())return-t(r,e);var n=12*(r.year()-e.year())+(r.month()-e.month()),o=e.clone().add(n,c),a=r-o<0,i=e.clone().add(n+(a?-1:1),c);return+(-(n+(r-o)/(a?o-i:i-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:l,w:s,d:i,D:f,h:a,m:o,s:n,ms:r,Q:u}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},g="en",b={};b[g]=h;var w="$isDayjsObject",_=function(t){return t instanceof M||!(!t||!t[w])},$=function t(e,r,n){var o;if(!e)return g;if("string"==typeof e){var a=e.toLowerCase();b[a]&&(o=a),r&&(b[a]=r,o=a);var i=e.split("-");if(!o&&i.length>1)return t(i[0])}else{var s=e.name;b[s]=e,o=s}return!n&&o&&(g=o),o||!n&&g},x=function(t,e){if(_(t))return t.clone();var r="object"==typeof e?e:{};return r.date=t,r.args=arguments,new M(r)},S=y;S.l=$,S.i=_,S.w=function(t,e){return x(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var M=function(){function h(t){this.$L=$(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var v=h.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,r=t.utc;if(null===e)return new Date(NaN);if(S.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var n=e.match(p);if(n){var o=n[2]-1||0,a=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)):new Date(n[1],o,n[3]||1,n[4]||0,n[5]||0,n[6]||0,a)}}return new Date(e)}(t),this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return S},v.isValid=function(){return!(this.$d.toString()===m)},v.isSame=function(t,e){var r=x(t);return this.startOf(e)<=r&&r<=this.endOf(e)},v.isAfter=function(t,e){return x(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<x(t)},v.$g=function(t,e,r){return S.u(t)?this[e]:this.set(r,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var r=this,u=!!S.u(e)||e,m=S.p(t),p=function(t,e){var n=S.w(r.$u?Date.UTC(r.$y,e,t):new Date(r.$y,e,t),r);return u?n:n.endOf(i)},d=function(t,e){return S.w(r.toDate()[t].apply(r.toDate("s"),(u?[0,0,0,0]:[23,59,59,999]).slice(e)),r)},h=this.$W,v=this.$M,y=this.$D,g="set"+(this.$u?"UTC":"");switch(m){case l:return u?p(1,0):p(31,11);case c:return u?p(1,v):p(0,v+1);case s:var b=this.$locale().weekStart||0,w=(h<b?h+7:h)-b;return p(u?y-w:y+(6-w),v);case i:case f:return d(g+"Hours",0);case a:return d(g+"Minutes",1);case o:return d(g+"Seconds",2);case n:return d(g+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var s,u=S.p(t),m="set"+(this.$u?"UTC":""),p=(s={},s[i]=m+"Date",s[f]=m+"Date",s[c]=m+"Month",s[l]=m+"FullYear",s[a]=m+"Hours",s[o]=m+"Minutes",s[n]=m+"Seconds",s[r]=m+"Milliseconds",s)[u],d=u===i?this.$D+(e-this.$W):e;if(u===c||u===l){var h=this.clone().set(f,1);h.$d[p](d),h.init(),this.$d=h.set(f,Math.min(this.$D,h.daysInMonth())).$d}else p&&this.$d[p](d);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[S.p(t)]()},v.add=function(r,u){var f,m=this;r=Number(r);var p=S.p(u),d=function(t){var e=x(m);return S.w(e.date(e.date()+Math.round(t*r)),m)};if(p===c)return this.set(c,this.$M+r);if(p===l)return this.set(l,this.$y+r);if(p===i)return d(1);if(p===s)return d(7);var h=(f={},f[o]=t,f[a]=e,f[n]=1e3,f)[p]||1,v=this.$d.getTime()+r*h;return S.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,r=this.$locale();if(!this.isValid())return r.invalidDate||m;var n=t||"YYYY-MM-DDTHH:mm:ssZ",o=S.z(this),a=this.$H,i=this.$m,s=this.$M,c=r.weekdays,u=r.months,l=r.meridiem,f=function(t,r,o,a){return t&&(t[r]||t(e,n))||o[r].slice(0,a)},p=function(t){return S.s(a%12||12,t,"0")},h=l||function(t,e,r){var n=t<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(d,(function(t,n){return n||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return S.s(e.$y,4,"0");case"M":return s+1;case"MM":return S.s(s+1,2,"0");case"MMM":return f(r.monthsShort,s,u,3);case"MMMM":return f(u,s);case"D":return e.$D;case"DD":return S.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return f(r.weekdaysMin,e.$W,c,2);case"ddd":return f(r.weekdaysShort,e.$W,c,3);case"dddd":return c[e.$W];case"H":return String(a);case"HH":return S.s(a,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return h(a,i,!0);case"A":return h(a,i,!1);case"m":return String(i);case"mm":return S.s(i,2,"0");case"s":return String(e.$s);case"ss":return S.s(e.$s,2,"0");case"SSS":return S.s(e.$ms,3,"0");case"Z":return o}return null}(t)||o.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,f,m){var p,d=this,h=S.p(f),v=x(r),y=(v.utcOffset()-this.utcOffset())*t,g=this-v,b=function(){return S.m(d,v)};switch(h){case l:p=b()/12;break;case c:p=b();break;case u:p=b()/3;break;case s:p=(g-y)/6048e5;break;case i:p=(g-y)/864e5;break;case a:p=g/e;break;case o:p=g/t;break;case n:p=g/1e3;break;default:p=g}return m?p:S.a(p)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return b[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var r=this.clone(),n=$(t,e,!0);return n&&(r.$L=n),r},v.clone=function(){return S.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},h}(),k=M.prototype;return x.prototype=k,[["$ms",r],["$s",n],["$m",o],["$H",a],["$W",i],["$M",c],["$y",l],["$D",f]].forEach((function(t){k[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),x.extend=function(t,e){return t.$i||(t(e,M,x),t.$i=!0),x},x.locale=$,x.isDayjs=_,x.unix=function(t){return x(1e3*t)},x.en=b[g],x.Ls=b,x.p={},x}()},752:(t,e,r)=>{var n=r(327).default;function o(){"use strict";t.exports=o=function(){return r},t.exports.__esModule=!0,t.exports.default=t.exports;var e,r={},a=Object.prototype,i=a.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",f=c.toStringTag||"@@toStringTag";function m(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{m({},"")}catch(e){m=function(t,e,r){return t[e]=r}}function p(t,e,r,n){var o=e&&e.prototype instanceof w?e:w,a=Object.create(o.prototype),i=new A(n||[]);return s(a,"_invoke",{value:T(t,r,i)}),a}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}r.wrap=p;var h="suspendedStart",v="suspendedYield",y="executing",g="completed",b={};function w(){}function _(){}function $(){}var x={};m(x,u,(function(){return this}));var S=Object.getPrototypeOf,M=S&&S(S(E([])));M&&M!==a&&i.call(M,u)&&(x=M);var k=$.prototype=w.prototype=Object.create(x);function O(t){["next","throw","return"].forEach((function(e){m(t,e,(function(t){return this._invoke(e,t)}))}))}function P(t,e){function r(o,a,s,c){var u=d(t[o],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==n(f)&&i.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(f).then((function(t){l.value=t,s(l)}),(function(t){return r("throw",t,s,c)}))}c(u.arg)}var o;s(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}})}function T(t,r,n){var o=h;return function(a,i){if(o===y)throw Error("Generator is already running");if(o===g){if("throw"===a)throw i;return{value:e,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=D(s,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=y;var u=d(t,r,n);if("normal"===u.type){if(o=n.done?g:v,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=g,n.method="throw",n.arg=u.arg)}}}function D(t,r){var n=r.method,o=t.iterator[n];if(o===e)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=e,D(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var a=d(o,t.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,b;var i=a.arg;return i?i.done?(r[t.resultName]=i.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=e),r.delegate=null,b):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function L(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function A(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(L,this),this.reset(!0)}function E(t){if(t||""===t){var r=t[u];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,a=function r(){for(;++o<t.length;)if(i.call(t,o))return r.value=t[o],r.done=!1,r;return r.value=e,r.done=!0,r};return a.next=a}}throw new TypeError(n(t)+" is not iterable")}return _.prototype=$,s(k,"constructor",{value:$,configurable:!0}),s($,"constructor",{value:_,configurable:!0}),_.displayName=m($,f,"GeneratorFunction"),r.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===_||"GeneratorFunction"===(e.displayName||e.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,$):(t.__proto__=$,m(t,f,"GeneratorFunction")),t.prototype=Object.create(k),t},r.awrap=function(t){return{__await:t}},O(P.prototype),m(P.prototype,l,(function(){return this})),r.AsyncIterator=P,r.async=function(t,e,n,o,a){void 0===a&&(a=Promise);var i=new P(p(t,e,n,o),a);return r.isGeneratorFunction(e)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},O(k),m(k,f,"Generator"),m(k,u,(function(){return this})),m(k,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},r.values=E,A.prototype={constructor:A,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(N),!t)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var r=this;function n(n,o){return s.type="throw",s.arg=t,r.next=n,o&&(r.method="next",r.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var c=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(c&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(c){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,r,n){return this.delegate={iterator:E(t),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=e),b}},r}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},327:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},943:(t,e,r)=>{var n=r(752)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n].call(a.exports,a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";r.r(n),r.d(n,{components:()=>ut,extend:()=>ct,helpers:()=>ft,models:()=>lt});const t=flarum.core.compat["forum/app"];var e=r.n(t);const o=flarum.core.compat["common/extend"],a=flarum.core.compat["common/components/Page"];var i=r.n(a);const s=flarum.core.compat["forum/components/IndexPage"];var c=r.n(s);function u(t,e){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},u(t,e)}function l(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,u(t,e)}const f=flarum.core.compat["common/components/Modal"];var p=r.n(f);const d=flarum.core.compat["common/components/Button"];var h=r.n(d);function v(t,e){return void 0===e&&(e="sort"),t.sort((function(t,r){return("function"==typeof t[e]?t[e]():t[e])-("function"==typeof r[e]?r[e]():r[e])}))}var y=r(912),g=r.n(y),b=function(t){function r(){return t.apply(this,arguments)||this}l(r,t);var n=r.prototype;return n.oninit=function(r){var n=this;t.prototype.oninit.call(this,r),e().store.all("fof-terms-policies").forEach((function(t){var r,o=t.id(),a=null==(r=e().session.user)?void 0:r.fofTermsPoliciesState(),i=o&&a?a[o]:void 0;n[t.form_key()]=t.optional()&&(null==i?void 0:i.is_accepted)||!1}))},n.title=function(){return e().translator.trans("fof-terms.forum.accept-modal.title")},n.className=function(){return"AcceptPoliciesModal Modal--medium"},n.content=function(){return m("div",{className:"Modal-body"},this.body())},n.body=function(){var t=this,r=v(e().store.all("fof-terms-policies").filter((function(t){var r,n=t.id(),o=null==(r=e().session.user)?void 0:r.fofTermsPoliciesState(),a=n&&o?o[n]:void 0;return!a||a.has_update})));return 0===r.length?m(h(),{className:"Button",onclick:function(){e().modal.close()}},e().translator.trans("fof-terms.forum.accept-modal.close")):r.map((function(n){return m("div",null,m("h2",null,n.name()),e().forum.attribute("fof-terms.hide-updated-at")?null:m("p",null,n.terms_updated_at()?e().translator.trans("fof-terms.forum.accept-modal.updated-at",{date:g()(n.terms_updated_at()).format(e().forum.attribute("fof-terms.date-format"))}):e().translator.trans("fof-terms.forum.accept-modal.updated-recently")),n.update_message()?m("p",null,n.update_message()):null,m("div",{className:"Form-group"},m("div",{className:"FoF-Terms-Check FoF-Terms-Check--login"},m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:t[n.form_key()],onchange:function(){t[n.form_key()]=!t[n.form_key()]}}),e().translator.trans("fof-terms.forum.accept-modal.i-accept",{policy:n.name(),a:n.url()?m("a",{href:n.url(),target:"_blank"}):m("span",null)})))),m(h(),{className:"Button Button--primary",disabled:!t[n.form_key()]&&!n.optional(),onclick:function(){var o,a=null==(o=e().session.user)?void 0:o.fofTermsPoliciesMustAccept();e().request({url:e().forum.attribute("apiUrl")+n.apiEndpoint()+(t[n.form_key()]?"/accept":"/decline"),method:"POST",errorHandler:t.onerror.bind(t)}).then((function(t){e().store.pushPayload(t),1===r.length&&(a?window.location.reload():e().modal.close()),m.redraw()}))}},e().translator.trans("fof-terms.forum.accept-modal.accept")))}))},r}(p());const w=flarum.core.compat["forum/components/SignUpModal"];var _=r.n(w);const $=flarum.core.compat["forum/components/DiscussionPage"];var x=r.n($);const S=flarum.core.compat["forum/components/UserPage"];var M=r.n(S);const k=flarum.core.compat["common/helpers/listItems"];var O=r.n(k),P=!1,T=function(){function t(){}var r=t.prototype;return r.shouldShowAlert=function(){if(P)return!1;var t=e().session.user;return t&&t.fofTermsPoliciesHasUpdate()},r.hasOnlyOptionalUpdates=function(){var t=e().session.user;return t&&!t.fofTermsPoliciesMustAccept()&&t.fofTermsPoliciesHasUpdate()},r.view=function(){var t=e().session.user;if(!this.shouldShowAlert()||!t)return null;var r=[m(h(),{className:"Button Button--link",onclick:function(){e().modal.show(b)}},e().translator.trans("fof-terms.forum.update-alert.review"))],n=[];return t.fofTermsPoliciesMustAccept()||n.push(m(h(),{icon:"fas fa-times",className:"Button Button--link Button--icon Alert-dismiss",onclick:function(){P=!0},"aria-label":e().translator.trans("fof-terms.forum.update-alert.close")})),m("div",{className:"Alert Alert-info"},m("div",{className:"container"},m("span",{className:"Alert-body"},this.hasOnlyOptionalUpdates()?e().translator.trans("fof-terms.forum.update-alert.can-accept-optional-message"):t.fofTermsPoliciesMustAccept()?e().translator.trans("fof-terms.forum.update-alert.must-accept-message"):e().translator.trans("fof-terms.forum.update-alert.can-accept-message")),m("ul",{className:"Alert-controls"},O()(r.concat(n)))))},t}();function D(t){for(var e=arguments.length,r=new Array(e>1?e-1:0),n=1;n<e;n++)r[n-1]=arguments[n];var o=t.apply(void 0,r),a=m(T,null);return Array.isArray(o)?(o.unshift(a),o):m("div",null,[a,o])}const L=flarum.core.compat["forum/utils/UserControls"];var N=r.n(L);const A=flarum.core.compat["common/helpers/humanTime"];var E=r.n(A),F=function(t){function r(){return t.apply(this,arguments)||this}l(r,t);var n=r.prototype;return n.title=function(){return e().translator.trans("fof-terms.forum.state-modal.title",{username:this.attrs.user.username()})},n.className=function(){return"UserPoliciesStateModal Modal--medium"},n.content=function(){var t=this;return m("div",{className:"Modal-body"},m("ul",null,v(e().store.all("fof-terms-policies")).map((function(r){var n=r.id(),o=t.attrs.user.fofTermsPoliciesState(),a=n&&o?o[n]:void 0;return m("li",null,r.name(),":"," ",a&&a.accepted_at?e().translator.trans("fof-terms.forum.state-modal.accepted-at",{date:E()(a.accepted_at)}):e().translator.trans("fof-terms.forum.state-modal.not-accepted"))}))))},r}(p());function j(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function U(t){return function(){var e=this,r=arguments;return new Promise((function(n,o){var a=t.apply(e,r);function i(t){j(a,n,o,i,s,"next",t)}function s(t){j(a,n,o,i,s,"throw",t)}i(void 0)}))}}var H=r(943),Y=r.n(H);const C=flarum.core.compat["forum/components/SettingsPage"];var I=r.n(C);const B=flarum.core.compat["common/components/FieldSet"];var W=r.n(B);const G=flarum.core.compat["common/components/Switch"];var z=r.n(G);const J=flarum.core.compat["common/components/Link"];var Z=r.n(J);function q(t,e){return R.apply(this,arguments)}function R(){return(R=U(Y().mark((function t(r,n){var o,a;return Y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=""+e().forum.attribute("apiUrl")+r.apiEndpoint()+(n?"/accept":"/decline"),t.next=3,e().request({url:o,method:"POST"});case 3:a=t.sent,e().store.pushPayload(a);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}const V=flarum.core.compat["common/extenders"];var Q=r.n(V);const K=flarum.core.compat["common/Model"];var X=r.n(K);const tt=flarum.core.compat["common/utils/computed"];var et=r.n(tt),rt=function(t){function e(){for(var e,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).sort=X().attribute("sort"),e.name=X().attribute("name"),e.url=X().attribute("url"),e.update_message=X().attribute("update_message"),e.terms_updated_at=X().attribute("terms_updated_at"),e.optional=X().attribute("optional"),e.additional_info=X().attribute("additional_info"),e.form_key=et()("id",(function(t){return"fof_terms_policy_"+t})),e}return l(e,t),e.prototype.apiEndpoint=function(){return"/fof/terms/policies"+(this.exists?"/"+this.id():"")},e}(X());const nt=[(new(Q().Store)).add("fof-terms-policies",rt)],ot=flarum.core.compat["common/models/User"];var at=r.n(ot);const it=flarum.core.compat["common/models/Forum"];var st=r.n(it);const ct=[].concat(nt,[new(Q().Model)(at()).attribute("fofTermsPoliciesState").attribute("fofTermsPoliciesHasUpdate").attribute("fofTermsPoliciesMustAccept").attribute("seeFoFTermsPoliciesState"),new(Q().Model)(st()).attribute("fof-terms.canSeeUserPoliciesState")]);var ut={AcceptPoliciesModal:b,UpdateAlert:T,UserPoliciesStateModal:F},lt={Policy:rt},ft={sortByAttribute:v};e().initializers.add("fof-terms",(function(){var t;t=!1,(0,o.extend)(i().prototype,"oninit",(function(){if(!t){if(e().current.matches(c())){var r=e().session.user;r&&r.fofTermsPoliciesMustAccept()&&setTimeout((function(){e().modal.show(b)}),0)}t=!0}})),(0,o.extend)(_().prototype,"oninit",(function(){var t,r=this;this.fofTermsPolicies=v(e().store.all("fof-terms-policies")),null==(t=this.fofTermsPolicies)||t.forEach((function(t){r[t.form_key()]=!1}))})),(0,o.extend)(_().prototype,"fields",(function(t){var r,n=this,o=e().forum.attribute("fof-terms.signup-legal-text");o&&t.add("fof-terms-legal-text",m("div",{className:"Form-group"},m("div",{className:"FoF-Terms-SignUp-Legal Alert"},o))),null==(r=this.fofTermsPolicies)||r.forEach((function(r){t.add("fof-terms-policy-"+r.id(),m("div",{className:"Form-group"},m("div",{className:"FoF-Terms-Check FoF-Terms-Check--signup"},m("label",{className:"checkbox"},m("input",{type:"checkbox",checked:n[r.form_key()],onchange:function(){n[r.form_key()]=!n[r.form_key()]},disabled:n.loading}),e().translator.trans("fof-terms.forum.signup.i-accept",{policy:r.name(),a:r.url()?m("a",{href:r.url(),target:"_blank"}):m("span",null)})))))}))})),(0,o.extend)(_().prototype,"submitData",(function(t){var e,r=this;null==(e=this.fofTermsPolicies)||e.forEach((function(e){t[e.form_key()]=r[e.form_key()]}))})),(0,o.override)(c().prototype,"hero",D),(0,o.override)(x().prototype,"view",D),(0,o.override)(M().prototype,"view",D),(0,o.extend)(N(),"moderationControls",(function(t,r){e().forum.attribute("fof-terms.canSeeUserPoliciesState")&&t.add("fof-terms.state",m(h(),{icon:"fas fa-paperclip",onclick:function(){e().modal.show(F,{user:r})}},e().translator.trans("fof-terms.forum.user_controls.state_button")))})),(0,o.extend)(I().prototype,"settingsItems",(function(t){var r,n=this,o=e().store.all("fof-terms-policies").filter((function(t){return t.optional()}));if(o.length){var a=null==(r=e().session.user)?void 0:r.fofTermsPoliciesState();a&&t.add("policies",m(W(),{label:e().translator.trans("fof-terms.forum.user_settings.optional_policies_label")},o.map((function(t){var e=t.id(),r=e&&a?a[e]:void 0,o=(null==r?void 0:r.is_accepted)||!1;return m("div",{className:"Fof-Terms-Policy-User-Settings-Management"},m(z(),{state:o,onchange:function(){var e=U(Y().mark((function e(r){var o;return Y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(o=t.id())&&a&&(a[o].is_accepted=r),n[t.form_key()]=r,e.next=5,q(t,r);case 5:m.redraw();case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}," ",t.url()?m(Z(),{target:"_blank",href:t.url()},t.name()):t.name()))}))),-99)}}))}))})(),module.exports=n})();
//# sourceMappingURL=forum.js.map